<!DOCTYPE html>
<html lang="pt" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Express√µes Regulares | Blog de Pedro Falc√£o</title>
<meta name="keywords" content="RegEx, Python, SQL">
<meta name="description" content="Como e quando usar RegEx?">
<meta name="author" content="Pedro Falc√£o">
<link rel="canonical" href="https://pfalcao97.githubpages.io/blog/posts/regex/">
<link crossorigin="anonymous" href="/blog/assets/css/stylesheet.e6d0f51515118adbcc1f077ef36c53f3b2d935f3a7f7c3408cb8b6cb3650059a.css" integrity="sha256-5tD1FRURitvMHwd&#43;82xT87LZNfOn98NAjLi2yzZQBZo=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/blog/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://pfalcao97.githubpages.io/blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://pfalcao97.githubpages.io/blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://pfalcao97.githubpages.io/blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://pfalcao97.githubpages.io/blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://pfalcao97.githubpages.io/blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement(document.body, {
          
          
          delimiters: [
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false},
              {left: '\\(', right: '\\)', display: false},
              {left: '\\[', right: '\\]', display: true}
          ],
          
          throwOnError : false
        });
    });
</script>
<meta property="og:title" content="Express√µes Regulares" />
<meta property="og:description" content="Como e quando usar RegEx?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pfalcao97.githubpages.io/blog/posts/regex/" />
<meta property="og:image" content="https://github.com/Pfalcao97/blog/blob/main/static/cover_regex.png?raw=true" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-08T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-07-08T00:00:00+00:00" /><meta property="og:site_name" content="Blog de Pedro Falc√£o" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://github.com/Pfalcao97/blog/blob/main/static/cover_regex.png?raw=true" />
<meta name="twitter:title" content="Express√µes Regulares"/>
<meta name="twitter:description" content="Como e quando usar RegEx?"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://pfalcao97.githubpages.io/blog/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Express√µes Regulares",
      "item": "https://pfalcao97.githubpages.io/blog/posts/regex/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Express√µes Regulares",
  "name": "Express√µes Regulares",
  "description": "Como e quando usar RegEx?",
  "keywords": [
    "RegEx", "Python", "SQL"
  ],
  "articleBody": "Introdu√ß√£o Quase todo mundo que est√° inserido no mundo da programa√ß√£o conhece sobre Express√µes Regulares, mas, t√£o frequente quanto, o conhecimento fica s√≥ no ‚Äúsobre‚Äù, mesmo: o modo de escrita, que beira a criptografia, e a falta de repert√≥rio para os casos de uso geram um sentimento generalizado de que RegEx √© ~basicamente~ m√°gica. Mas, diferente de m√°gica ‚Äúde verdade‚Äù, conhecer o segredo e estragar a ilus√£o pode ser muito mais vantajoso.\nClaro, existem necessidades diferentes, que v√£o desde escrever uma express√£o simples para debugar o c√≥digo no seu editor, at√© fazer a extra√ß√£o de informa√ß√µes em dados n√£o estruturados, passando por melhorar a legibilidade de uma query no SQL. O que importa √© que, com um pouco de sitzfleisch, voc√™ pode adicionar mais uma ferramenta no seu arcabou√ßo e se tornar mais produtivo.\nA ideia do texto √© apenas molhar seus p√©s nesse universo, desmistificando o dialeto m√≠stico que separa os juniores dos s√™niors, a partir de uma compreens√£o mais palat√°vel.\nPuxando a cortina Para continuar a analogia da m√°gica, vamos puxar a cortina no meio do espet√°culo, tal qual o Mr. M. De forma simples, aquelas instru√ß√µes escritas em caracteres aparentemente aleat√≥rios s√£o instru√ß√µes para definir uma m√°quina de estados finita, basicamente um circuito l√≥gico com estados. Uma boa forma de entender esse conceito √© com o exemplo dispon√≠vel na p√°gina da Wikip√©dia: uma catraca.\nO estado ‚Äúnatural‚Äù, ou inicial, da catraca √© travada, voc√™ pode tentar empurrar, mas ela continua travada. A partir do momento que voc√™ passa o seu cart√£o com cr√©ditos suficiente, a catraca √© destravada. Ela fica nesse estado at√© que voc√™ a empurre, fazendo com que ela retorne ao estado natural.\nT√°, mas como n√≥s transportamos essa ideia para identificar um texto?\nVou responder isso usando um exemplo: suponha que voc√™ deseje criar uma dessas m√°quinas de estados finita que reconhe√ßa palavras entre aspas. Nesse caso, n√≥s teremos tr√™s estados:\nEstado inicial: vamos percorrer nosso texto, caracter a caracter, come√ßando aqui. Esse estado indica, efetivamente, que estamos come√ßando uma nova busca. S√≥ iremos passar pro pr√≥ximo, caso encontremos o caracter \" (aspas duplas). Estado intermedi√°rio: encontramos o in√≠cio, agora precisamos achar o fim. Tudo que for letra encontrada pelo caminho n√£o altera o estado, a √∫nica coisa capaz de fazer com que n√≥s passemos de estado √©, novamente, o caracter ‚Äú. Estado final: se chegamos at√© aqui, significa que tivemos um match, ou seja, encontramos a combina√ß√£o de caracteres capaz de percorrer todo o nosso algoritmo e podemos retornar esse texto. Para exercitar a imagina√ß√£o, eu gosto de pensar em uma setinha em cima das letras, conforme percorremos o texto. A seta indica qual estado estamos, dizendo algo do tipo ‚ÄúIsso √© um A, n√£o √© um caracter que muda o meu estado‚Äù ou ‚ÄúEpa, encontrei uma aspa dupla, muda de estado e vamos esperar para encontrar a pr√≥xima‚Äù, como na ferramenta Regexp::Debugger. [1]\nProgramaticamente, poder√≠amos fazer algo similar da seguinte forma:\nestado = 1 # Estado inicial match = '' # Nosso match for caracter in texto: # Faz um loop, letra a letra, pelo texto if estado == 2: # Caso estejamos no estado intermedi√°rio, match += caracter # adiciona o caracter √† vari√°vel de match if caracter == '\"': # Se encontrar uma aspa dupla, estado += 1 # muda de estado if estado != 3: # A menos que o estado seja o final, match += caracter # adiciona o caracter √† vari√°vel de match Embora essas representa√ß√µes deixem a inten√ß√£o mais clara, a dificuldade de desenhar diagramas de m√°quinas de estados finitas para cada caso (particularmente os mais complexos) se tornou um problema. Mas o criador das express√µes regulares, Stephen Kleene, deu um jeito de abreviar isso, gerando a forma como escrevemos express√µes regulares hoje. Todas as linhas de c√≥digo poderiam ser substitu√≠do por uma √∫nica linha:\nimport re match = re.search('\".*\"', texto).group() Bem mais compacto, n√©?\nPois ent√£o, se definirmos o seguinte texto:\ntexto = \"\"\"Este √© um exemplo de texto que cont√©m \"aspas duplas\"!\"\"\" Os dois c√≥digos resultam no mesmo valor para a vari√°vel match:\n‚Äúaspas duplas‚Äù\nNota do autor: re √© a biblioteca nativa de express√µes regulares do Python. A documenta√ß√£o est√° nas fontes, no final da p√°gina. üòâ\nO beab√° do RegEx Agora voc√™ pode dizer: ‚ÄúT√°, muito legal, muito interessante, mas isso n√£o me ajuda em nada a escrever RegEx‚Äù. Sim, verdade, mas √© importante construir essa intui√ß√£o antes de come√ßar a estudar de fato, porque assim tem menos decoreba e mais compreens√£o.\nSe eu tiver feito bem o meu trabalho, quando eu escrevi o RegEx ali em cima (\".*\"), voc√™ achou legal como ele resume tanta coisa. E a ideia √© continuar nesse mote, ao inv√©s de voc√™ olhar um asterisco e falar ‚ÄúQue merda √© essa?!‚Äù, eu espero que voc√™, no m√≠nimo, reconhe√ßa seu poder sintetizador.\nPois bem, nessa linha, existem duas classes que podem definir um caracter numa express√£o regular:\nLiteral: √© quando o caracter representa ele pr√≥prio. A √© A. Se voc√™ quer saber se a palavra ‚ÄúPa√ßoca‚Äù aparece no texto, basta usar a pr√≥pria palavra. Reservado: um caracter √© reservado, ou especial, quando o seu significa surpassa o seu simbolo, um bom exemplo √© o j√° mencionado asterisco, que representa a repeti√ß√£o de um caracter ‚Äúzero ou mais vezes‚Äù. Ou seja, um RegEx como b*d√° match com ‚Äô ‚Äò, ‚Äòb‚Äô, ‚Äòbb‚Äô, ‚Äòbbb‚Äô e assim por diante. √Äs vezes, voc√™ precisa usar um caracter reservado como literal, para isso usamos a barra invertida \\. Ou seja, para usar o asterisco como asterisco, e n√£o como ‚Äúzero ou mais vezes‚Äù, basta colocar \\*.\nMas o que acontece se a gente usar a barra invertida em um literal?\nBom, na maioria das vezes, nada. Mas algumas combina√ß√µes s√£o, pasmem, boas sintetizadoras. Por exemplo, caso voc√™ queira encontrar um n√∫mero de um digito, ou seja 0 ou 1 ou 2 ou‚Ä¶ ou 9. Voc√™ pode fazer um RegEx assim:\nre.search('0|1|2|3|4|5|6|7|8|9', texto).group() # A barra vertical, |, indica \"ou\". Ou voc√™ pode usar \\d - Qualquer digito num√©rico. Claro, quem conhece um pouquinho de RegEx deve estar me xingando pela forma acima, que nunca seria utilizada, sendo prefer√≠vel a forma mais compacta: [0-9]. Mas eu prometo que n√£o vou deixar ponto sem n√≥, tudo tem um motivo (sim, at√© o \".*\", pros mais avan√ßados).\nE, com isso, a gente j√° tem os pilares para come√ßar a construir algumas express√µes progressivamente mais dif√≠ceis.\nVelocidade um na dan√ßa do cr√©u Essa primeira parte √© a que todo usu√°rio de computador conhece: quando voc√™ aperta ctrl+f (ou cmd+f üçé) para pesquisar uma palavra em uma p√°gina da web. Voc√™ digita a palavra que voc√™ est√° procurando e ela √© grifada na p√°gina. √â pura e simplesmente o uso de uma express√£o literal.\nEmbora isso possa parecer t√£o √≥bvio que voc√™ talvez nem perceba, esse √© um dos casos mais utilizados, na minha experi√™ncia. Por exemplo, voc√™ est√° analisando um banco de dados de produtos de moda e quer ver todos os produtos com cor rosa, para fazer um marketing de oportunidade pro filme da Barbie, basta rodar uma query assim:\nSELECT * FROM tabela_produtos WHERE LOWER(nome_produto) LIKE 'rosa' Assim n√≥s encontramos aqueles produtos como ‚ÄúCamiseta M B√°sica Rosa‚Äù ou ‚ÄúSalto Alto Rosa‚Äù. O problema √© que muitas vezes o analista n√£o conhece muito de RegEx (ou aprendeu esse ‚Äútruque‚Äù do LIKE e replica, sem pensar muito no que est√° fazendo) e a query rapidamente vira uma macarronada com dezenas de linhas fazendo v√°rios filtros de LIKE na mesma coluna.\nPara resolver isso‚Ä¶\nVelocidade dois na dan√ßa do cr√©u Aqui a gente come√ßa a adicionar alguns daqueles caracteres reservados. Seja usando a j√° mencionada barra vertical ou os colchetes. Por exemplo, em uma lista de cidades com o nome da seguinte forma:\nCidade, Estado (Ex: S√£o Paulo, SP)\nComo podemos contar quantas cidades s√£o da regi√£o Norte?\nimport re qtd_cidades_norte = len(re.findall(\"AC|AM|AP|PA|RO|RR|TO\", lista_cidades)) Agora, se voc√™ quisesse saber quais s√£o essas cidades, fica um pouco mais dif√≠cil. No caso do RegEx que eu escrevi ali, ele vai procurar as siglas dos estados no texto e adicionar essas siglas √† lista. Por isso ela √© √∫til s√≥ pra fazer a contagem. Ou em casos espec√≠ficos, como quando voc√™ √© mais liberal com a sua defini√ß√£o da cor rosa:\nSELECT * FROM tabela_produtos WHERE REGEXP_LIKE(nome_produto, 'rosa|rox[ao]', 'i') Parece que eu adicionei muita coisa de uma vez, mas vamos por partes:\nAl√©m da cor rosa, tamb√©m vamos procurar as pe√ßas com a cor roxa, portanto rosa|roxa. Roxo, por√©m, √© um adjetivo que possui flex√µes diferentes, conforme o g√™nero do substantivo (‚ÄúCamiseta Roxa‚Äù ou ‚ÄúLen√ßo Roxo‚Äù), diferente do rosa. Assim, precisamos levar em considera√ß√£o as duas vers√µes. Mas, ao inv√©s de escrever rosa|roxa|roxo, como a ra√≠z ‚Äúrox‚Äù √© igual para as duas palavras, podemos fazer o seguinte: rox[ao], ou seja, ‚ÄúEncontre uma palavra que come√ßa com ‚Äòrox‚Äô e termina com ‚Äòa‚Äô ou ‚Äòo‚Äô‚Äù. Portanto: rosa|rox[ao]. Ao inv√©s de usar o LIKE, eu estou utilizando REGEXP_LIKE, para poder usar a flag i, que indica que n√£o vou fazer diferencia√ß√£o entre letras mai√∫sculas e min√∫sculas. T√° ficando dif√≠cil, ein?! At√© agora, n√£o escrevemos nada que salte os olhos como especialmente complexo. Mas nesse pr√≥ximo n√≠vel, a gente precisa come√ßar a incluir alguns daqueles s√≠mbolos diferentes.\nImagine, por exemplo, que voc√™ esteja auxiliando na digitaliza√ß√£o de documentos em uma empresa. Algu√©m j√° transformou os arquivos f√≠sicos em arquivos digitais, por√©m ainda √© preciso colocar alguns desses dados em bases de dados. Uma dessas informa√ß√µes √© a data de admiss√£o de todos os colaboradores. A sua chefa acabou de te pedir para fazer isso.\n√â evidente que esse trabalho n√£o seria t√£o compartimentado assim, mas, para fim de exemplo, exercite sua suspens√£o da descren√ßa: voc√™ s√≥ precisa salvar o nome do arquivo e a data de admiss√£o, depois algu√©m junta todos os dados do funcion√°rios em uma tabela, usando o nome de arquivo como chave prim√°ria.\nO documento √© um .txtque toma a seguinte forma:\nNome: Fulano de Tal\nCargo: Engenheiro de Dados\nData de Nascimento: 01/01/1990\nData de Admiss√£o: 01/01/2020\nUma boa forma de come√ßar √© pegar s√≥ a parte que voc√™ quer e garantir que voc√™ est√° conseguindo corresponder com ela. No nosso caso, queremos uma data com o formato DIA/M√äS/ANO, ou seja: dois digitos num√©ricos + / + dois digitos num√©ricos + / + quatro digitos num√©ricos:\nimport re re.search('\\d\\d/\\d\\d/\\d\\d\\d\\d', '01/01/2020').group() Claro, se voc√™ j√° percebeu o modus operandi da ferramenta, h√° uma forma de simplificar a constru√ß√£o de caracteres iguais repetindo N vezes (quando N √© conhecido e fixo, j√° vimos que para vezes indeterminadas pode se usar o asterisco), usando as chaves, {N}:\nimport re re.search('\\d{2}/\\d{2}/\\d{4}', '01/01/2020').group() As chaves podem, ainda, te dizer o m√°ximo e o m√≠nimo de repeti√ß√µes. Se voc√™ soubesse que em alguns casos o in√≠cio das datas foram omitidos (por exemplo ‚Äú01/01/2020‚Äù sendo escrito como ‚Äú1/1/20‚Äù), voc√™ poderia colocar a quantidade m√≠nima e m√°xima de repeti√ß√µes que voc√™ espera ver, usando a s√≠ntaxe {N√∫mero m√≠nimo de repeti√ß√µes, N√∫mero m√°ximo de repeti√ß√µes}:\nimport re re.search('\\d{1,2}/\\d{1,2}/\\d{2,4}', '01/01/2020').group() S√≥ tem um problema‚Ä¶ Da mesma forma que o c√≥digo funciona para a data desejada, tamb√©m funciona para ‚Äú99/99/9999‚Äù, que, obviamente, n√£o √© uma data. Se voc√™ tiver certeza que tudo est√° corretamente digitalizado, voc√™ poderia apenas usar o RegEx acima, mas √© poss√≠vel encontrar erros de digitaliza√ß√£o se voc√™ restringir um pouco o c√≥digo: sabemos que os dias s√≥ podem come√ßar com 0, 1, 2 ou 3, que os meses s√≥ podem come√ßar com 0 ou 1 e que o ano s√≥ pode come√ßar com 1 ou 2 (ou s√≥ 2, caso sua empresa tenha sido fundada depois do ano 2000), portanto podemos deixar nosso RegEx mais robusto (e confi√°vel) da seguinte forma:\nimport re re.search('[0123]{0,1}\\d/[01]{0,1}\\d/[12]{0,1}\\d{2,3}', '01/01/2020').group() Agora t√° come√ßando a ficar com uma carinha legal, n√©?\nDepois disso fica f√°cil, a gente s√≥ precisa garantir que o RegEx pega a data de admiss√£o e n√£o a de nascimento, mas para isso basta usar o texto literal, que √© est√°tico:\nimport re re.search('Data de Admiss√£o: [0123]{0,1}\\d/[01]{0,1}\\d/[12]{0,1}\\d{2,3}', 'Data de Admiss√£o: 01/01/2020').group() Bom, na verdade, quase basta, porque se usarmos esse c√≥digo, ele vai trazer inclusive o texto ‚ÄúData de Admiss√£o: ‚Äú, que n√≥s n√£o queremos. Para separar o joio do trigo, n√≥s podemos utilizar grupos. Nesse caso, √© poss√≠vel adicionar um grupo de captura, usando o par√™nteses em torno da data. A√≠ sim, temos o c√≥digo completo para automatizar esse processo:\nfrom os import listdir from re import search lista_de_datas = list() diretorio = \"/caminho/\" # Caminho da pasta com os arquivos for documento in listdir(diretorio): if '.txt' in documento: # L√™ os documentos with open(diretorio + documento, 'r') as lupa: texto = lupa.read() # Salva o nome do documento e a data de admiss√£o em # uma tupla, e essa tupla em uma lista lista_de_datas.append( (documento, search('Data de Admiss√£o: ([0123]{0,1}\\d/[01]{0,1}\\d/[12]{0,1}\\d{2,3})', texto).group(1)) ) cr√©u cr√©u cr√©u cr√©u cr√©u‚Ä¶ (cr√©u )* üòÜ Tocamos brevemente no √∫ltimo ponto que quero fazer, na se√ß√£o anterior: o poder do RegEx como validador. Qualquer um que j√° teve a oportunidade de cuidar de um banco de dados com dados digitados por usu√°rio (como dados de cadastro), teve a experi√™ncia √∫nica de descobrir que pessoas que nasceram em 1822, ou que v√£o nascer em 3034, s√£o compradoras frequentes da sua loja.\nO ponto √©: essas informa√ß√µes n√£o s√£o sempre confi√°veis.\nNota do Autor: esta √© uma obra de fic√ß√£o. Os personagens, acontecimentos e nomes retratados s√£o inventados e qualquer semalhan√ßa com a realidade √© mera coincid√™ncia\nMas n√≥s podemos melhorar isso com uma camada de valida√ß√£o no cadastro: por que aceitar um dado que n√≥s j√° sabemos que √© errado? Validadores de CPF, por exemplo, s√£o t√£o comuns que viraram exerc√≠cio para estudantes de programa√ß√£o. Por que n√£o fazer o mesmo com validadores de outras informa√ß√µes, como emails e n√∫meros de telefone, para estudantes de RegEx?\nNa verdade, at√© tem um porqu√™‚Ä¶ Eu preciso ser sincero: a valida√ß√£o de email usando RegEx √© incompleta e extremamente confusa, por alguns motivos:\nDa mesma forma que um CPF estar no formato v√°lido, n√£o garante a exist√™ncia dele, um email v√°lido n√£o necessariamente existe. Para checar isso, √© necess√°rio o uso de outras ferramentas. Existem muitas formas de emails v√°lidos, principalmente formas que n√≥s n√£o temos contato no dia-a-dia, que s√£o raras e diferentes, mas‚Ä¶ MAS voc√™ entrar o seu email corretamente e o site n√£o aceitar, porque um programador teve pregui√ßa na hora de fazer um RegEx, √© uma das piores experi√™ncias poss√≠veis para um usu√°rio. Recomendo evitar, se voc√™ quiser mant√™-lo como cliente. Para um RegEx que obede√ßa √†s normas oficiais (pelo menos na √©poca em que foi escrita - N√£o, eu n√£o chequei), d√™ uma olhada na refer√™ncia [2]. Mas, aqui, vamos prezar pelo simples:\nO usu√°rio pode ter letras mai√∫sculas ou min√∫sculas, n√∫meros, ‚Äú.‚Äù, ‚Äú-‚Äù e ‚Äú_‚Äù.\nO servidor ser√° apenas de alto n√≠vel e contendo apenas letras (isso significa que vamos ignorar o IP do servidor).\nIgualmente, vamos manter s√≥ dom√≠nios ‚Äú.com‚Äù.\nAntes de prosseguir, quero s√≥ enfatizar mais uma vez: estou mais preocupado com o didatismo, use o c√≥digo abaixo com parcim√¥nia. Se voc√™ quer algo um pouco mais completo, esse site clama ter c√≥digos que funcionam 99,99% das vezes (Mas, ainda assim, a palavra de ordem √© ‚ú® parcim√¥nia ‚ú®. Experi√™ncia do usu√°rio √© importante).\nO fim √© mais f√°cil, ent√£o comecemos por ele:\nimport re re.search(\"@[a-z]+.com$\", '@servidor.com').group() Os principais servidores comerciais s√£o contemplados por essa regra, que diz, basicamente: Encontre um texto que come√ßa com o ‚Äú@‚Äù, depois tem uma ou mais (uma ou mais est√° representado pelo +) letras min√∫sculas at√© encontrar o termo ‚Äú.com‚Äù, que √© a √∫ltima parte do texto (representado pelo cifr√£o).\nEm cima disso, precisamos adicionar a parte do usu√°rio, que √© um pouco menos restritiva, pois ela pode conter letras mai√∫sculas [A-Z] ou min√∫sculas [a-z], n√∫meros [0-9], o ponto, o h√≠fen e a barra inferior.\nimport re re.search(\"^[a-zA-Z0-9_\\.-]+@[a-z]+.com$\", 'fulano.detal90@servidor.com').group() Fizemos algo bem parecido, mas, ao inv√©s de considerar o fim do texto, $, estamos considerando o in√≠cio, ^, e ao inv√©s de considerarmos s√≥ as letras min√∫sculas, temos uma ou mais (+) de qualquer dos caracteres citados. Esse RegEx √© muito bom para enxugar uma lista de emails que vai ser usada em CRM, apesar de n√£o ser t√£o boa para valida√ß√£o.\nE talvez voc√™ esteja achando estranho o tom t√£o preocupado que estou tendo em rela√ß√£o √† valida√ß√£o. N√£o √© impress√£o sua, o tom √© propostial e eu vou te contar o porqu√™‚Ä¶\nTamanho √© documento, SIM! Lembra que comentei que eu n√£o ia deixar ponto sem n√≥? Ent√£o, se voc√™ √© um bom aluno (ü§ì) e estiver testando junto com o texto, pode ter percebido que o \".*\"funciona, pero no mucho. Porque, no exemplo cuidadosamente selecionado que dei, √© uma maravilha, mas se voc√™ coloca duas frases com aspas duplas, d√° tudo errado. Por que? Eu menti pra voc√™?!\nExiste mais de uma forma para chegar ao seu objetivo com RegEx e, a bem da verdade, existem formas melhores e piores. Essa que eu sugeri, √© uma das piores, porque o asterisco √© um modificador ganancioso, isso significa que ele pega o m√°ximo de caracteres poss√≠veis. Para o momento, ele estava mais do que suficiente, mas, depois de tudo que passamos juntos, acho que eu posso ter uma conversa mais s√©ria com voc√™.\nEscrever um bom RegEx √© sin√¥nimo de muitos testes e pensar fora da caixa, porque √© preciso ver se ele funciona em todas as situa√ß√µes em que voc√™ precisa que ele funcione e, t√£o importante quanto, n√£o funcione quando voc√™ precise que ele n√£o funcione. H√°, ainda, que se considerar a performace. Por isso, no geral, Express√µes regulares mais completas e mais longas, s√£o melhores. Se voc√™ tomar atalhos, sua performace, sua seguran√ßa ou os dois, podem sofrer.\nFoi exatamente isso que aconteceu com a Cloudflare, em 2019. Vale a pena a leitura da descri√ß√£o completa do problema no blog deles ([3]), especialmente se voc√™ se interessa por seguran√ßa, mas o resumo da opera √©:\nUm engenheiro escreveu um c√≥digo RegEx para o WAF (Web Application Firewall) do servi√ßo. WAF √© um firewall espec√≠fico para chamadas HTTP, que visa proteger os servi√ßos de ataques maliciosos como SQL Injection ou outras formas de interagir com o servidor usando comandos ‚Äúescondidos‚Äù na query. O c√≥digo era esse: (?:(?:\"|‚Äô|]|}|\\|\\d|(?:nan|infinity|true|false|null|undefined|symbol|math)|`|-|+)+[)];?((?:\\s|-|~|!|{}||||+).(?:.=.*)))\nPela natureza desse tipo de a√ß√£o, que deve ser r√°pida para impedir que O Mais Novo Cyber Ataque‚Ñ¢Ô∏è cause estragos, algu√©m escreve um c√≥digo, h√° uma valida√ß√£o entre o time de engenharia, que aceita o Pull Request e o commit √© feito, sendo implementado em todos os servidores ao redor do globo em segundos, sem, naquele momento, todas as precau√ß√µes necess√°rias.\nN√£o haviam travas ou testes de consumo de CPU para barrar o RegEx, apenas testes de detec√ß√£o, isso fez que o c√≥digo mal otimizado, particularmente .*.*=.*, exigisse muito do CPU do servidor, para toda nova requisi√ß√£o. Em poucos minutos essa regra fritou os servidores globais da CloudFlare, deixando v√°rios servi√ßos fora do ar.\nO que aconteceu foi, basicamente, uma regra perigosa (Procure qualquer coisa de qualquer tamanho, seguida de qualquer coisa de qualquer tamanho, seguida de um igual, seguida de qualquer coisa de qualquer tamanho) e a falta de testes suficientes gerando um problema de escala global.\nO perigo nesse tipo de regra √© conhecido, damos a ele o nome Catastrophic Backtracking (Em tradu√ß√£o livre, seria algo como Marcha-r√© Catastr√≥fica): a regra √© escrita de uma maneira que o motor RegEx precisa checar m√∫ltiplas vezes uma mesma palavra, para verificar a exist√™ncia de correspond√™ncias.\nPor isso a √™nfase que estou tendo, particularmente em c√≥digos de valida√ß√£o, √© preciso testes e travas que protejam o ambiente contra essas situa√ß√µes catastr√≥ficas, al√©m da tal parcim√¥nia na hora de escrever os c√≥digos, sempre pensando em situa√ß√µes limite.\nConclus√£o As express√µes regulares s√£o uma das ferramentas mais poderosas na programa√ß√£o, ela pode, literalmente, transformar sua vida em um inferno ou agilizar seu trabalho em muitas vezes. Embora eu n√£o espere que voc√™ saia desse texto com a capacidade de escrever um c√≥digo RegEx capaz de encontrar n√∫meros primos (recomendo demais olhar isso, √© uma das coisas mais legais que j√° vi feitas com RegEx - [4]), eu espero que ele tenha sido √∫til para, ao menos, desmistificar os c√≥digos e te incentivar a finalmente estudar.\nCita√ß√µes [1] - Watch RegExes with Regexp::Debugger\n[2] - Mail::RFC822::Address: RegExp-based address validation [3] - How Regular Expressions and a WAF DoS-ed Cloudflare\n[4] - A regular expression to check for prime numbers\nFontes Regular Expressions, Computerphile, 2020-01-09. (Acesso em Julho de 2023)\nTutorial, RegExp.info (Acesso em Julho de 2023)\nDocumenta√ß√£o re, Python Software Foundation (Acesso em Julho de 2023)\nDocumenta√ß√£o do PostgreSQL, PostgreSQL Global Developmente Group (Acesso em Julho de 2023)\nUnder the Hood: Regular Expressions, Reindeer Effect, 2018-06-24 (Acesso em Julho de 2023)\nRegexes: The Bad, the Better, and the Best, Liz Bennett, 2015-06-18 (Acesso em Julho de 2023)\n",
  "wordCount" : "3488",
  "inLanguage": "pt",
  "image":"https://github.com/Pfalcao97/blog/blob/main/static/cover_regex.png?raw=true","datePublished": "2023-07-08T00:00:00Z",
  "dateModified": "2023-07-08T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Pedro Falc√£o"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://pfalcao97.githubpages.io/blog/posts/regex/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Blog de Pedro Falc√£o",
    "logo": {
      "@type": "ImageObject",
      "url": "https://pfalcao97.githubpages.io/blog/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://pfalcao97.githubpages.io/blog" accesskey="h" title="Blog de Pedro Falc√£o (Alt + H)">Blog de Pedro Falc√£o</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://pfalcao97.githubpages.io/blog/categories/" title="Categorias">
                    <span>Categorias</span>
                </a>
            </li>
            <li>
                <a href="https://pfalcao97.githubpages.io/blog/aboutme/" title="Sobre mim">
                    <span>Sobre mim</span>
                </a>
            </li>
            <li>
                <a href="https://pfalcao97.githubpages.io/blog/archives/" title="Blog Posts">
                    <span>Blog Posts</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://pfalcao97.githubpages.io/blog">In√≠cio</a>&nbsp;¬ª&nbsp;<a href="https://pfalcao97.githubpages.io/blog/posts/">Posts</a></div>
    <h1 class="post-title">
      Express√µes Regulares
    </h1>
    <div class="post-description">
      Como e quando usar RegEx?
    </div>
    <div class="post-meta"><span title='2023-07-08 00:00:00 +0000 UTC'>julho 8, 2023</span>&nbsp;¬∑&nbsp;17 minutos&nbsp;¬∑&nbsp;Pedro Falc√£o

</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://github.com/Pfalcao97/blog/blob/main/static/cover_regex.png?raw=true" alt="Express√µes Regulares">
        
</figure>
  <div class="post-content"><h2 id="introdu√ß√£o">Introdu√ß√£o<a hidden class="anchor" aria-hidden="true" href="#introdu√ß√£o">#</a></h2>
<p>Quase todo mundo que est√° inserido no mundo da programa√ß√£o conhece sobre Express√µes Regulares, mas, t√£o frequente quanto, o conhecimento fica s√≥ no &ldquo;sobre&rdquo;, mesmo: o modo de escrita, que beira a criptografia, e a falta de repert√≥rio para os casos de uso geram um sentimento generalizado de que RegEx √© ~basicamente~ m√°gica. Mas, diferente de m√°gica &ldquo;de verdade&rdquo;, conhecer o segredo e estragar a ilus√£o pode ser muito mais vantajoso.</p>
<p>Claro, existem necessidades diferentes, que v√£o desde escrever uma express√£o simples para <em>debugar</em> o c√≥digo no seu editor, at√© fazer a extra√ß√£o de informa√ß√µes em dados n√£o estruturados, passando por melhorar a legibilidade de uma query no SQL. O que importa √© que, com um pouco de <a href="https://www.bbc.com/worklife/article/20180903-to-have-sitzfleisch---its-a-professional-compliment"><em>sitzfleisch</em></a>, voc√™ pode adicionar mais uma ferramenta no seu arcabou√ßo e se tornar mais produtivo.</p>
<p>A ideia do texto √© apenas molhar seus p√©s nesse universo, desmistificando o dialeto m√≠stico que separa os juniores dos s√™niors, a partir de uma compreens√£o mais palat√°vel.</p>
<h2 id="puxando-a-cortina">Puxando a cortina<a hidden class="anchor" aria-hidden="true" href="#puxando-a-cortina">#</a></h2>
<p>Para continuar a analogia da m√°gica, vamos puxar a cortina no meio do espet√°culo, tal qual o Mr. M. De forma simples, aquelas instru√ß√µes escritas em caracteres aparentemente aleat√≥rios s√£o instru√ß√µes para definir uma m√°quina de estados finita, basicamente um circuito l√≥gico com estados. Uma boa forma de entender esse conceito √© com o exemplo dispon√≠vel na <a href="https://en.wikipedia.org/wiki/Finite-state_machine">p√°gina da Wikip√©dia</a>: uma catraca.</p>
<p>O <strong>estado</strong> &ldquo;natural&rdquo;, ou inicial, da catraca √© travada, voc√™ pode tentar empurrar, mas ela continua travada. A partir do momento que voc√™ passa o seu cart√£o com cr√©ditos suficiente, a catraca √© destravada. Ela fica nesse <strong>estado</strong> at√© que voc√™ a empurre, fazendo com que ela retorne ao <strong>estado</strong> natural.</p>
<figure class="align-center ">
    <img loading="lazy" src="https://github.com/Pfalcao97/blog/blob/main/static/finitestatemachine.png?raw=true#center" width="auto"/> 
</figure>

<p>T√°, mas <strong>como n√≥s transportamos essa ideia para identificar um texto?</strong></p>
<p>Vou responder isso usando um exemplo: suponha que voc√™ deseje criar uma dessas m√°quinas de estados finita que reconhe√ßa palavras entre aspas. Nesse caso, n√≥s teremos tr√™s estados:</p>
<ol>
<li><strong>Estado inicial:</strong> vamos percorrer nosso texto, caracter a caracter, come√ßando aqui. Esse estado indica, efetivamente, que estamos come√ßando uma nova busca. S√≥ iremos passar pro pr√≥ximo, caso encontremos o caracter &quot; (aspas duplas).</li>
<li><strong>Estado intermedi√°rio:</strong> encontramos o in√≠cio, agora precisamos achar o fim. Tudo que for letra encontrada pelo caminho n√£o altera o estado, a √∫nica coisa capaz de fazer com que n√≥s passemos de estado √©, novamente, o caracter &ldquo;.</li>
<li><strong>Estado final:</strong> se chegamos at√© aqui, significa que tivemos um <em>match</em>, ou seja, encontramos a combina√ß√£o de caracteres capaz de percorrer todo o nosso algoritmo e podemos retornar esse texto.</li>
</ol>
<p>Para exercitar a imagina√ß√£o, eu gosto de pensar em uma setinha em cima das letras, conforme percorremos o texto. A seta indica qual estado estamos, dizendo algo do tipo <em>&ldquo;Isso √© um A, n√£o √© um caracter que muda o meu estado&rdquo;</em> ou <em>&ldquo;Epa, encontrei uma aspa dupla, muda de estado e vamos esperar para encontrar a pr√≥xima&rdquo;</em>, como na ferramenta <a href="https://metacpan.org/pod/Regexp::Debugger">Regexp::Debugger</a>. <strong>[1]</strong></p>
<p>Programaticamente, poder√≠amos fazer algo similar da seguinte forma:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>estado <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#75715e"># Estado inicial</span>
</span></span><span style="display:flex;"><span>match <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#75715e"># Nosso match</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> caracter <span style="color:#f92672">in</span> texto: <span style="color:#75715e"># Faz um loop, letra a letra, pelo texto</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> estado <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>:       <span style="color:#75715e"># Caso estejamos no estado intermedi√°rio,</span>
</span></span><span style="display:flex;"><span>        match <span style="color:#f92672">+=</span> caracter <span style="color:#75715e"># adiciona o caracter √† vari√°vel de match</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> caracter <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;&#34;&#39;</span>: <span style="color:#75715e"># Se encontrar uma aspa dupla,                       </span>
</span></span><span style="display:flex;"><span>        estado <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>     <span style="color:#75715e"># muda de estado</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> estado <span style="color:#f92672">!=</span> <span style="color:#ae81ff">3</span>:       <span style="color:#75715e"># A menos que o estado seja o final,</span>
</span></span><span style="display:flex;"><span>            match <span style="color:#f92672">+=</span> caracter <span style="color:#75715e"># adiciona o caracter √† vari√°vel de match</span>
</span></span></code></pre></div><p>Embora essas representa√ß√µes deixem a inten√ß√£o mais clara, a dificuldade de desenhar diagramas de m√°quinas de estados finitas para cada caso (particularmente os mais complexos) se tornou um problema. Mas o criador das express√µes regulares, Stephen Kleene, deu um jeito de abreviar isso, gerando a forma como escrevemos express√µes regulares hoje. Todas as linhas de c√≥digo poderiam ser substitu√≠do por uma √∫nica linha:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>match <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;&#34;.*&#34;&#39;</span>, texto)<span style="color:#f92672">.</span>group()
</span></span></code></pre></div><p>Bem mais compacto, n√©?</p>
<p>Pois ent√£o, se definirmos o seguinte texto:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>texto <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;Este √© um exemplo de texto que cont√©m &#34;aspas duplas&#34;!&#34;&#34;&#34;</span>
</span></span></code></pre></div><p>Os dois c√≥digos resultam no mesmo valor para a vari√°vel <code>match</code>:</p>
<blockquote>
<p>&ldquo;aspas duplas&rdquo;</p>
</blockquote>
<p><em>Nota do autor: re √© a biblioteca nativa de express√µes regulares do Python. A documenta√ß√£o est√° nas fontes, no final da p√°gina.</em> üòâ</p>
<h2 id="o-beab√°--do-regex">O beab√°  do RegEx<a hidden class="anchor" aria-hidden="true" href="#o-beab√°--do-regex">#</a></h2>
<p>Agora voc√™ pode dizer: <em>&ldquo;T√°, muito legal, muito interessante, mas isso n√£o me ajuda em nada a escrever RegEx&rdquo;</em>. Sim, verdade, mas √© importante construir essa intui√ß√£o antes de come√ßar a estudar de fato, porque assim tem menos <em>decoreba</em> e mais <strong>compreens√£o</strong>.</p>
<p>Se eu tiver feito bem o meu trabalho, quando eu escrevi o RegEx ali em cima (<code>&quot;.*&quot;</code>), voc√™ achou legal como ele resume tanta coisa. E a ideia √© continuar nesse mote, ao inv√©s de voc√™ olhar um asterisco e falar <em>&ldquo;Que merda √© essa?!&rdquo;</em>, eu espero que voc√™, no m√≠nimo, reconhe√ßa seu <em>poder sintetizador</em>.</p>
<p>Pois bem, nessa linha, existem duas classes que podem definir um caracter numa express√£o regular:</p>
<ul>
<li><strong>Literal:</strong> √© quando o caracter representa ele pr√≥prio. <strong>A √© A</strong>. Se voc√™ quer saber se a palavra &ldquo;Pa√ßoca&rdquo; aparece no texto, basta usar a pr√≥pria palavra.</li>
<li><strong>Reservado:</strong> um caracter √© reservado, ou especial, quando o seu significa surpassa o seu simbolo, um bom exemplo √© o j√° mencionado asterisco, que representa a repeti√ß√£o de um caracter &ldquo;zero ou mais vezes&rdquo;. Ou seja, um RegEx como <code>b*</code>d√° match com &rsquo; &lsquo;, &lsquo;b&rsquo;, &lsquo;bb&rsquo;, &lsquo;bbb&rsquo; e assim por diante.</li>
</ul>
<p>√Äs vezes, voc√™ precisa usar um caracter reservado como literal, para isso usamos a barra invertida <code>\</code>. Ou seja, para usar o asterisco como asterisco, e n√£o como &ldquo;zero ou mais vezes&rdquo;, basta colocar <code>\*</code>.</p>
<p>Mas o que acontece se a gente usar a barra invertida em um literal?</p>
<p>Bom, na maioria das vezes, nada. Mas algumas combina√ß√µes s√£o, pasmem, boas sintetizadoras. Por exemplo, caso voc√™ queira encontrar um n√∫mero de um digito, ou seja <em>0 ou 1 ou 2 ou&hellip; ou 9</em>. Voc√™ pode fazer um RegEx assim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;0|1|2|3|4|5|6|7|8|9&#39;</span>, texto)<span style="color:#f92672">.</span>group()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># A barra vertical, |, indica &#34;ou&#34;.</span>
</span></span></code></pre></div><p>Ou voc√™ pode usar <code>\d</code> - Qualquer digito num√©rico. Claro, quem conhece um pouquinho de RegEx deve estar me xingando pela forma acima, que nunca seria utilizada, sendo prefer√≠vel a forma mais compacta: <code>[0-9]</code>. Mas eu prometo que n√£o vou deixar ponto sem n√≥, tudo tem um motivo (sim, at√© o <code>&quot;.*&quot;</code>, pros mais avan√ßados).</p>
<p>E, com isso, a gente j√° tem os pilares para come√ßar a construir algumas express√µes progressivamente mais dif√≠ceis.</p>
<h1 id="heading"><a hidden class="anchor" aria-hidden="true" href="#heading">#</a></h1>
<h1 id="heading-1"><a hidden class="anchor" aria-hidden="true" href="#heading-1">#</a></h1>
<h3 id="velocidade-um-na-dan√ßa-do-cr√©u">Velocidade um na dan√ßa do cr√©u<a hidden class="anchor" aria-hidden="true" href="#velocidade-um-na-dan√ßa-do-cr√©u">#</a></h3>
<p>Essa primeira parte √© a que todo usu√°rio de computador conhece: quando voc√™ aperta ctrl+f (ou cmd+f üçé) para pesquisar uma palavra em uma p√°gina da web. Voc√™ digita a palavra que voc√™ est√° procurando e ela √© grifada na p√°gina. √â pura e simplesmente o uso de uma express√£o literal.</p>
<p>Embora isso possa parecer t√£o √≥bvio que voc√™ talvez nem perceba, esse √© um dos casos mais utilizados, na minha experi√™ncia. Por exemplo, voc√™ est√° analisando um banco de dados de produtos de moda e quer ver todos os produtos com cor rosa, para fazer um marketing de oportunidade pro filme da Barbie, basta rodar uma query assim:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span>
</span></span><span style="display:flex;"><span>    tabela_produtos
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">LOWER</span>(nome_produto) <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;rosa&#39;</span>
</span></span></code></pre></div><p>Assim n√≥s encontramos aqueles produtos como &ldquo;Camiseta M B√°sica Rosa&rdquo; ou &ldquo;Salto Alto Rosa&rdquo;. O problema √© que muitas vezes o analista n√£o conhece muito de RegEx (ou aprendeu esse &ldquo;truque&rdquo; do <code>LIKE</code> e replica, sem pensar muito no que est√° fazendo) e a query rapidamente vira uma macarronada com dezenas de linhas fazendo v√°rios filtros de <code>LIKE</code> na mesma coluna.</p>
<p>Para resolver isso&hellip;</p>
<h3 id="velocidade-dois-na-dan√ßa-do-cr√©u">Velocidade dois na dan√ßa do cr√©u<a hidden class="anchor" aria-hidden="true" href="#velocidade-dois-na-dan√ßa-do-cr√©u">#</a></h3>
<p>Aqui a gente come√ßa a adicionar alguns daqueles caracteres reservados. Seja usando a j√° mencionada barra vertical ou os colchetes. Por exemplo, em uma lista de cidades com o nome da seguinte forma:</p>
<blockquote>
<p>Cidade, Estado (Ex: S√£o Paulo, SP)</p>
</blockquote>
<p>Como podemos contar quantas cidades s√£o da regi√£o Norte?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>qtd_cidades_norte <span style="color:#f92672">=</span> len(re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">&#34;AC|AM|AP|PA|RO|RR|TO&#34;</span>, lista_cidades))
</span></span></code></pre></div><p>Agora, se voc√™ quisesse saber <em>quais</em> s√£o essas cidades, fica um pouco mais dif√≠cil. No caso do RegEx que eu escrevi ali, ele vai procurar as siglas dos estados no texto e adicionar essas siglas √† lista. Por isso ela √© √∫til s√≥ pra fazer a contagem. Ou em casos espec√≠ficos, como quando voc√™ √© mais liberal com a sua defini√ß√£o da cor rosa:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span>
</span></span><span style="display:flex;"><span>    tabela_produtos
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> 
</span></span><span style="display:flex;"><span>    REGEXP_LIKE(nome_produto, <span style="color:#e6db74">&#39;rosa|rox[ao]&#39;</span>, <span style="color:#e6db74">&#39;i&#39;</span>)
</span></span></code></pre></div><p>Parece que eu adicionei muita coisa de uma vez, mas vamos por partes:</p>
<ol>
<li>Al√©m da cor rosa, tamb√©m vamos procurar as pe√ßas com a cor roxa, portanto <code>rosa|roxa</code>.</li>
<li>Roxo, por√©m, √© um adjetivo que possui flex√µes diferentes, conforme o g√™nero do substantivo (&ldquo;Camiseta Roxa&rdquo; ou &ldquo;Len√ßo Roxo&rdquo;), diferente do rosa. Assim, precisamos levar em considera√ß√£o as duas vers√µes. Mas, ao inv√©s de escrever <code>rosa|roxa|roxo</code>, como a ra√≠z &ldquo;rox&rdquo; √© igual para as duas palavras, podemos fazer o seguinte: <code>rox[ao]</code>, ou seja, <em>&ldquo;Encontre uma palavra que come√ßa com &lsquo;rox&rsquo; e termina com &lsquo;a&rsquo; ou &lsquo;o&rsquo;&rdquo;</em>. Portanto: <code>rosa|rox[ao]</code>.</li>
<li>Ao inv√©s de usar o <code>LIKE</code>, eu estou utilizando <code>REGEXP_LIKE</code>, para poder usar a flag <code>i</code>, que indica que n√£o vou fazer diferencia√ß√£o entre letras mai√∫sculas e min√∫sculas.</li>
</ol>
<h3 id="t√°-ficando-dif√≠cil-ein">T√° ficando dif√≠cil, ein?!<a hidden class="anchor" aria-hidden="true" href="#t√°-ficando-dif√≠cil-ein">#</a></h3>
<p>At√© agora, n√£o escrevemos nada que salte os olhos como especialmente complexo. Mas nesse pr√≥ximo n√≠vel, a gente precisa come√ßar a incluir alguns daqueles s√≠mbolos diferentes.</p>
<p>Imagine, por exemplo, que voc√™ esteja auxiliando na digitaliza√ß√£o de documentos em uma empresa. Algu√©m j√° transformou os arquivos f√≠sicos em arquivos digitais, por√©m ainda √© preciso colocar alguns desses dados em bases de dados. Uma dessas informa√ß√µes √© a data de admiss√£o de todos os colaboradores. A sua chefa acabou de te pedir para fazer isso.</p>
<p>√â evidente que esse trabalho n√£o seria t√£o compartimentado assim, mas, para fim de exemplo, exercite sua suspens√£o da descren√ßa: voc√™ s√≥ precisa salvar o nome do arquivo e a data de admiss√£o, depois algu√©m junta todos os dados do funcion√°rios em uma tabela, usando o nome de arquivo como chave prim√°ria.</p>
<p>O documento √© um <code>.txt</code>que toma a seguinte forma:</p>
<blockquote>
<p>Nome: Fulano de Tal</p>
<p>Cargo: Engenheiro de Dados</p>
<p>Data de Nascimento: 01/01/1990</p>
<p>Data de Admiss√£o: 01/01/2020</p>
</blockquote>
<p>Uma boa forma de come√ßar √© pegar s√≥ a parte que voc√™ quer e garantir que voc√™ est√° conseguindo corresponder com ela. No nosso caso, queremos uma data com o formato DIA/M√äS/ANO, ou seja: <em>dois digitos num√©ricos + / + dois digitos num√©ricos + / + quatro digitos num√©ricos</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;\d\d/\d\d/\d\d\d\d&#39;</span>, <span style="color:#e6db74">&#39;01/01/2020&#39;</span>)<span style="color:#f92672">.</span>group()
</span></span></code></pre></div><p>Claro, se voc√™ j√° percebeu o <em>modus operandi</em> da ferramenta, h√° uma forma de simplificar a constru√ß√£o de caracteres iguais repetindo N vezes (quando N √© conhecido e fixo, j√° vimos que para vezes indeterminadas pode se usar o asterisco), usando as chaves, <code>{N}</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;\d</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">/\d</span><span style="color:#e6db74">{2}</span><span style="color:#e6db74">/\d</span><span style="color:#e6db74">{4}</span><span style="color:#e6db74">&#39;</span>, <span style="color:#e6db74">&#39;01/01/2020&#39;</span>)<span style="color:#f92672">.</span>group()
</span></span></code></pre></div><p>As chaves podem, ainda, te dizer o m√°ximo e o m√≠nimo de repeti√ß√µes. Se voc√™ soubesse que em alguns casos o in√≠cio das datas foram omitidos (por exemplo &ldquo;01/01/2020&rdquo; sendo escrito como &ldquo;1/1/20&rdquo;), voc√™ poderia colocar a quantidade m√≠nima e m√°xima de repeti√ß√µes que voc√™ espera ver, usando a s√≠ntaxe <code>{N√∫mero m√≠nimo de repeti√ß√µes, N√∫mero m√°ximo de repeti√ß√µes}</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;\d{1,2}/\d{1,2}/\d{2,4}&#39;</span>, <span style="color:#e6db74">&#39;01/01/2020&#39;</span>)<span style="color:#f92672">.</span>group()
</span></span></code></pre></div><p>S√≥ tem um problema&hellip; Da mesma forma que o c√≥digo funciona para a data desejada, tamb√©m funciona para &ldquo;99/99/9999&rdquo;, que, obviamente, n√£o √© uma data. Se voc√™ tiver certeza que tudo est√° corretamente digitalizado, voc√™ poderia apenas usar o RegEx acima, mas √© poss√≠vel encontrar erros de digitaliza√ß√£o se voc√™ restringir um pouco o c√≥digo: sabemos que os dias s√≥ podem come√ßar com 0, 1, 2 ou 3, que os meses s√≥ podem come√ßar com 0 ou 1 e que o ano s√≥ pode come√ßar com 1 ou 2 (ou s√≥ 2, caso sua empresa tenha sido fundada depois do ano 2000), portanto podemos deixar nosso RegEx mais robusto (e confi√°vel) da seguinte forma:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;[0123]{0,1}\d/[01]{0,1}\d/[12]{0,1}\d{2,3}&#39;</span>, <span style="color:#e6db74">&#39;01/01/2020&#39;</span>)<span style="color:#f92672">.</span>group()
</span></span></code></pre></div><p>Agora t√° come√ßando a ficar com uma carinha legal, n√©?</p>
<p>Depois disso fica f√°cil, a gente s√≥ precisa garantir que o RegEx pega a data de admiss√£o e n√£o a de nascimento, mas para isso basta usar o texto literal, que √© est√°tico:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#39;Data de Admiss√£o: [0123]{0,1}\d/[01]{0,1}\d/[12]{0,1}\d{2,3}&#39;</span>, 
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;Data de Admiss√£o: 01/01/2020&#39;</span>)<span style="color:#f92672">.</span>group()
</span></span></code></pre></div><p>Bom, na verdade, <strong>quase</strong> basta, porque se usarmos esse c√≥digo, ele vai trazer inclusive o texto &ldquo;Data de Admiss√£o: &ldquo;, que n√≥s n√£o queremos. Para separar o joio do trigo, n√≥s podemos utilizar <strong>grupos</strong>. Nesse caso, √© poss√≠vel adicionar um <strong>grupo de captura</strong>, usando o par√™nteses em torno da data. A√≠ sim, temos o c√≥digo completo para automatizar esse processo:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> os <span style="color:#f92672">import</span> listdir
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> re <span style="color:#f92672">import</span> search
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lista_de_datas <span style="color:#f92672">=</span> list()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>diretorio <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/caminho/&#34;</span> <span style="color:#75715e"># Caminho da pasta com os arquivos</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> documento <span style="color:#f92672">in</span> listdir(diretorio):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;.txt&#39;</span> <span style="color:#f92672">in</span> documento:
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># L√™ os documentos</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> open(diretorio <span style="color:#f92672">+</span> documento, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> lupa:
</span></span><span style="display:flex;"><span>            texto <span style="color:#f92672">=</span> lupa<span style="color:#f92672">.</span>read() 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Salva o nome do documento e a data de admiss√£o em</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># uma tupla, e essa tupla em uma lista</span>
</span></span><span style="display:flex;"><span>        lista_de_datas<span style="color:#f92672">.</span>append(
</span></span><span style="display:flex;"><span>            (documento, 
</span></span><span style="display:flex;"><span>            search(<span style="color:#e6db74">&#39;Data de Admiss√£o: ([0123]{0,1}\d/[01]{0,1}\d/[12]{0,1}\d{2,3})&#39;</span>, 
</span></span><span style="display:flex;"><span>                    texto)<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>        )
</span></span></code></pre></div><h3 id="cr√©u-cr√©u-cr√©u-cr√©u-cr√©u">cr√©u cr√©u cr√©u cr√©u cr√©u&hellip;<a hidden class="anchor" aria-hidden="true" href="#cr√©u-cr√©u-cr√©u-cr√©u-cr√©u">#</a></h3>
<h4 id="cr√©u--"><code>(cr√©u )*</code> üòÜ<a hidden class="anchor" aria-hidden="true" href="#cr√©u--">#</a></h4>
<p>Tocamos brevemente no √∫ltimo ponto que quero fazer, na se√ß√£o anterior: o poder do RegEx como validador. Qualquer um que j√° teve a oportunidade de cuidar de um banco de dados com dados digitados por usu√°rio (como dados de cadastro), teve a experi√™ncia √∫nica de descobrir que pessoas que nasceram em 1822, ou que v√£o nascer em 3034, s√£o compradoras frequentes da sua loja.</p>
<p>O ponto √©: essas informa√ß√µes n√£o s√£o sempre confi√°veis.</p>
<p><em>Nota do Autor: esta √© uma obra de fic√ß√£o. Os personagens, acontecimentos e nomes retratados s√£o inventados e qualquer semalhan√ßa com a realidade √© mera coincid√™ncia</em></p>
<p>Mas n√≥s podemos melhorar isso com uma camada de valida√ß√£o no cadastro: por que aceitar um dado que n√≥s j√° sabemos que √© errado? Validadores de CPF, por exemplo, s√£o t√£o comuns que viraram exerc√≠cio para estudantes de programa√ß√£o. Por que n√£o fazer o mesmo com validadores de outras informa√ß√µes, como emails e n√∫meros de telefone, para estudantes de RegEx?</p>
<p>Na verdade, at√© tem um porqu√™&hellip; Eu preciso ser sincero: <strong>a valida√ß√£o de email usando RegEx √© incompleta e extremamente confusa</strong>, por alguns motivos:</p>
<ol>
<li>Da mesma forma que um CPF estar no formato v√°lido, n√£o garante a exist√™ncia dele, um email v√°lido n√£o necessariamente existe. Para checar isso, √© necess√°rio o uso de outras ferramentas.</li>
<li>Existem muitas formas de emails v√°lidos, principalmente formas que n√≥s n√£o temos contato no dia-a-dia, que s√£o raras e diferentes, mas&hellip;</li>
<li>MAS voc√™ entrar o seu email corretamente e o site n√£o aceitar, porque um programador teve pregui√ßa na hora de fazer um RegEx, √© uma das piores experi√™ncias poss√≠veis para um usu√°rio. Recomendo evitar, se voc√™ quiser mant√™-lo como cliente.</li>
</ol>
<p>Para um RegEx que obede√ßa √†s normas oficiais (pelo menos na √©poca em que foi escrita - N√£o, eu n√£o chequei), d√™ uma olhada na refer√™ncia <strong>[2]</strong>. Mas, aqui, vamos prezar pelo simples:</p>
<blockquote>
<p>O usu√°rio pode ter letras mai√∫sculas ou min√∫sculas, n√∫meros, &ldquo;.&rdquo;, &ldquo;-&rdquo; e &ldquo;_&rdquo;.</p>
<p>O servidor ser√° apenas de alto n√≠vel e contendo apenas letras (isso significa que vamos ignorar o IP do servidor).</p>
<p>Igualmente, vamos manter s√≥ dom√≠nios &ldquo;.com&rdquo;.</p>
</blockquote>
<p>Antes de prosseguir, quero s√≥ enfatizar mais uma vez: <strong>estou mais preocupado com o didatismo, use o c√≥digo abaixo com parcim√¥nia</strong>. Se voc√™ quer algo um pouco mais completo, <a href="https://emailRegEx.com/">esse site</a> clama ter c√≥digos que funcionam 99,99% das vezes <em>(Mas, ainda assim, a palavra de ordem √© ‚ú® <strong>parcim√¥nia</strong> ‚ú®. Experi√™ncia do usu√°rio √© importante)</em>.</p>
<p>O fim √© mais f√°cil, ent√£o comecemos por ele:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#34;@[a-z]+.com$&#34;</span>, <span style="color:#e6db74">&#39;@servidor.com&#39;</span>)<span style="color:#f92672">.</span>group()
</span></span></code></pre></div><p>Os principais servidores comerciais s√£o contemplados por essa regra, que diz, basicamente: <em>Encontre um texto que come√ßa com o &ldquo;@&rdquo;, depois tem uma ou mais (uma ou mais est√° representado pelo <code>+</code>) letras min√∫sculas at√© encontrar o termo &ldquo;.com&rdquo;, que √© a √∫ltima parte do texto (representado pelo cifr√£o)</em>.</p>
<p>Em cima disso, precisamos adicionar a parte do usu√°rio, que √© um pouco menos restritiva, pois ela pode conter letras mai√∫sculas <code>[A-Z]</code> ou min√∫sculas <code>[a-z]</code>, n√∫meros <code>[0-9]</code>, o ponto, o h√≠fen e a barra inferior.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">&#34;^[a-zA-Z0-9_\.-]+@[a-z]+.com$&#34;</span>, 
</span></span><span style="display:flex;"><span>          <span style="color:#e6db74">&#39;fulano.detal90@servidor.com&#39;</span>)<span style="color:#f92672">.</span>group()
</span></span></code></pre></div><p>Fizemos algo bem parecido, mas, ao inv√©s de considerar o fim do texto, <code>$</code>, estamos considerando o in√≠cio, <code>^</code>, e ao inv√©s de considerarmos s√≥ as letras min√∫sculas, temos uma ou mais (<code>+</code>) de qualquer dos caracteres citados. Esse RegEx √© muito bom para enxugar uma lista de emails que vai ser usada em CRM, apesar de n√£o ser t√£o boa para valida√ß√£o.</p>
<p>E talvez voc√™ esteja achando estranho o tom t√£o preocupado que estou tendo em rela√ß√£o √† valida√ß√£o. N√£o √© impress√£o sua, o tom √© propostial e eu vou te contar o porqu√™&hellip;</p>
<h2 id="tamanho-√©-documento-sim">Tamanho √© documento, SIM!<a hidden class="anchor" aria-hidden="true" href="#tamanho-√©-documento-sim">#</a></h2>
<p>Lembra que comentei que eu n√£o ia deixar ponto sem n√≥? Ent√£o, se voc√™ √© um bom aluno (ü§ì) e estiver testando junto com o texto, pode ter percebido que o <code>&quot;.*&quot;</code>funciona, <em>pero no mucho</em>. Porque, no exemplo cuidadosamente selecionado que dei, √© uma maravilha, mas se voc√™ coloca duas frases com aspas duplas, d√° tudo errado. Por que? Eu menti pra voc√™?!</p>
<p>Existe mais de uma forma para chegar ao seu objetivo com RegEx e, a bem da verdade, existem formas melhores e piores. Essa que eu sugeri, √© uma das piores, porque o asterisco √© um modificador <strong>ganancioso</strong>, isso significa que ele pega <strong>o m√°ximo de caracteres poss√≠veis</strong>. Para o momento, ele estava mais do que suficiente, mas, depois de tudo que passamos juntos, acho que eu posso ter uma conversa mais s√©ria com voc√™.</p>
<p>Escrever um bom RegEx √© sin√¥nimo de muitos testes e pensar fora da caixa, porque √© preciso ver se ele funciona em todas as situa√ß√µes em que voc√™ precisa que ele funcione e, t√£o importante quanto, n√£o funcione quando voc√™ precise que ele n√£o funcione. H√°, ainda, que se considerar a performace. Por isso, no geral, <strong>Express√µes regulares mais completas e mais longas, s√£o melhores</strong>. Se voc√™ tomar atalhos, sua performace, sua seguran√ßa ou os dois, podem sofrer.</p>
<p>Foi exatamente isso que aconteceu com a Cloudflare, em 2019. Vale a pena a leitura da descri√ß√£o completa do problema no blog deles (<strong>[3]</strong>), especialmente se voc√™ se interessa por seguran√ßa, mas o resumo da opera √©:</p>
<ol>
<li>Um engenheiro escreveu um c√≥digo RegEx para o WAF (<em>Web Application Firewall</em>) do servi√ßo. WAF √© um firewall espec√≠fico para chamadas HTTP, que visa proteger os servi√ßos de ataques maliciosos como SQL Injection ou outras formas de interagir com o servidor usando comandos &ldquo;escondidos&rdquo; na query. O c√≥digo era esse:</li>
</ol>
<blockquote>
<p>(?:(?:&quot;|&rsquo;|]|}|\|\d|(?:nan|infinity|true|false|null|undefined|symbol|math)|`|-|+)+[)]<em>;?((?:\s|-|~|!|{}||||+)</em>.<em>(?:.</em>=.*)))</p>
</blockquote>
<ol start="2">
<li>
<p>Pela natureza desse tipo de a√ß√£o, que deve ser r√°pida para impedir que <strong>O Mais Novo Cyber Ataque</strong>‚Ñ¢Ô∏è cause estragos, algu√©m escreve um c√≥digo, h√° uma valida√ß√£o entre o time de engenharia, que aceita o <em>Pull Request</em> e o <em>commit</em> √© feito, sendo implementado em todos os servidores ao redor do globo em segundos, sem, naquele momento, todas as precau√ß√µes necess√°rias.</p>
</li>
<li>
<p>N√£o haviam travas ou testes de consumo de CPU para barrar o RegEx, apenas testes de detec√ß√£o, isso fez que o c√≥digo mal otimizado, particularmente <code>.*.*=.*</code>, exigisse muito do CPU do servidor, para toda nova requisi√ß√£o. Em poucos minutos essa regra fritou os servidores globais da CloudFlare, deixando v√°rios servi√ßos fora do ar.</p>
</li>
</ol>
<p>O que aconteceu foi, basicamente, uma regra perigosa (<em>Procure qualquer coisa de qualquer tamanho, seguida de qualquer coisa de qualquer tamanho, seguida de um igual, seguida de qualquer coisa de qualquer tamanho</em>) e a falta de testes suficientes gerando um problema de escala global.</p>
<p>O perigo nesse tipo de regra √© conhecido, damos a ele o nome <em>Catastrophic Backtracking</em> (Em tradu√ß√£o livre, seria algo como Marcha-r√© Catastr√≥fica): a regra √© escrita de uma maneira que o motor RegEx precisa checar m√∫ltiplas vezes uma mesma palavra, para verificar a exist√™ncia de correspond√™ncias.</p>
<figure class="align-center ">
    <img loading="lazy" src="https://blog.cloudflare.com/content/images/2019/07/555-steps.gif#center"/> 
</figure>

<p>Por isso a √™nfase que estou tendo, particularmente em c√≥digos de valida√ß√£o, √© preciso testes e travas que protejam o ambiente contra essas situa√ß√µes catastr√≥ficas, al√©m da tal parcim√¥nia na hora de escrever os c√≥digos, sempre pensando em situa√ß√µes limite.</p>
<h2 id="conclus√£o">Conclus√£o<a hidden class="anchor" aria-hidden="true" href="#conclus√£o">#</a></h2>
<p>As express√µes regulares s√£o uma das ferramentas mais poderosas na programa√ß√£o, ela pode, literalmente, transformar sua vida em um inferno ou agilizar seu trabalho em muitas vezes. Embora eu n√£o espere que voc√™ saia desse texto com a capacidade de escrever um c√≥digo RegEx capaz de encontrar n√∫meros primos (recomendo demais olhar isso, √© uma das coisas mais legais que j√° vi feitas com RegEx - <strong>[4]</strong>), eu espero que ele tenha sido √∫til para, ao menos, desmistificar os c√≥digos e te incentivar a finalmente estudar.</p>
<h2 id="cita√ß√µes">Cita√ß√µes<a hidden class="anchor" aria-hidden="true" href="#cita√ß√µes">#</a></h2>
<p><strong>[1] -</strong> <a href="https://www.learning-perl.com/2016/06/watch-RegExes-with-RegExpdebugger/">Watch RegExes with Regexp::Debugger</a></p>
<p><strong>[2] -</strong> <a href="https://www.ex-parrot.com/%7Epdw/Mail-RFC822-Address.html">Mail::RFC822::Address: RegExp-based address validation </a></p>
<p><strong>[3] -</strong> <a href="https://www.acunetix.com/blog/web-security-zone/regular-expressions-waf-cloudflare/">How Regular Expressions and a WAF DoS-ed Cloudflare</a></p>
<p><strong>[4] -</strong> <a href="https://www.noulakaz.net/2007/03/18/a-regular-expression-to-check-for-prime-numbers/">A regular expression to check for prime numbers</a></p>
<h2 id="fontes">Fontes<a hidden class="anchor" aria-hidden="true" href="#fontes">#</a></h2>
<p><a href="https://www.youtube.com/watch?v=528Jc3q86F8">Regular Expressions</a>, Computerphile, 2020-01-09. (Acesso em Julho de 2023)</p>
<p><a href="https://www.regular-expressions.info/tutorial.html">Tutorial</a>, RegExp.info (Acesso em Julho de 2023)</p>
<p><a href="https://docs.python.org/3/library/re.html">Documenta√ß√£o re</a>, Python Software Foundation (Acesso em Julho de 2023)</p>
<p><a href="https://www.postgresql.org/docs/">Documenta√ß√£o do PostgreSQL</a>, PostgreSQL Global Developmente Group (Acesso em Julho de 2023)</p>
<p><a href="https://reindeereffect.github.io/2018/06/24/index.html">Under the Hood: Regular Expressions</a>, Reindeer Effect, 2018-06-24 (Acesso em Julho de 2023)</p>
<p><a href="https://www.loggly.com/blog/RegExes-the-bad-better-best/">Regexes: The Bad, the Better, and the Best</a>, Liz Bennett, 2015-06-18 (Acesso em Julho de 2023)</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://pfalcao97.githubpages.io/blog/tags/regex/">RegEx</a></li>
      <li><a href="https://pfalcao97.githubpages.io/blog/tags/python/">Python</a></li>
      <li><a href="https://pfalcao97.githubpages.io/blog/tags/sql/">SQL</a></li>
    </ul>

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Express√µes Regulares on twitter"
        href="https://twitter.com/intent/tweet/?text=Express%c3%b5es%20Regulares&amp;url=https%3a%2f%2fpfalcao97.githubpages.io%2fblog%2fposts%2fregex%2f&amp;hashtags=RegEx%2cPython%2cSQL">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Express√µes Regulares on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fpfalcao97.githubpages.io%2fblog%2fposts%2fregex%2f&amp;title=Express%c3%b5es%20Regulares&amp;summary=Express%c3%b5es%20Regulares&amp;source=https%3a%2f%2fpfalcao97.githubpages.io%2fblog%2fposts%2fregex%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Express√µes Regulares on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fpfalcao97.githubpages.io%2fblog%2fposts%2fregex%2f&title=Express%c3%b5es%20Regulares">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Express√µes Regulares on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fpfalcao97.githubpages.io%2fblog%2fposts%2fregex%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Express√µes Regulares on whatsapp"
        href="https://api.whatsapp.com/send?text=Express%c3%b5es%20Regulares%20-%20https%3a%2f%2fpfalcao97.githubpages.io%2fblog%2fposts%2fregex%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Express√µes Regulares on telegram"
        href="https://telegram.me/share/url?text=Express%c3%b5es%20Regulares&amp;url=https%3a%2f%2fpfalcao97.githubpages.io%2fblog%2fposts%2fregex%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://pfalcao97.githubpages.io/blog">Blog de Pedro Falc√£o</a></span>
    <span>
        Powered by
        
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a>,
        <a href="https://pages.github.com/" rel="noopener noreferrer" target="_blank">Github Pages</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copiar';

        function copyingDone() {
            copybutton.innerHTML = 'copiado!';
            setTimeout(() => {
                copybutton.innerHTML = 'copiar';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
<br>
</body>

</html>
